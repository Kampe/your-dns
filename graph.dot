digraph G {
  rankdir=LR;
  compound=true;
  subgraph cluster_0 {
    style=filled;
    color=lightgrey;
    node [style=filled,color=white];
    label = "your-dns";
    subgraph cluster_2 {
        style=filled;
        color=grey;
        label="coredns"
        coredns_encrypted [label="Encrypted DNS (port 853/443)"];
        coredns_DNS [label="Plaintext DNS\n(port 53)"];
    }
    pihole;
  }
  subgraph cluster_3 {
      label="Legend";
      node [shape="plaintext"];
    key [label=<<table border="0" cellpadding="0" cellspacing="0" cellborder="0">
      <tr><td align="right" port="i1">Encrypted (DoT/DoH)</td></tr>
      <tr><td align="right" port="i2">Unencrypted (Plaintext DNS)</td></tr>
      </table>>]
    key2 [label=<<table border="0" cellpadding="0" cellspacing="0" cellborder="0">
      <tr><td port="i1">&nbsp;</td></tr>
      <tr><td port="i2">&nbsp;</td></tr>
      </table>>]
    key:i1:e -> key2:i1:w [color=red]
    key:i2:e -> key2:i2:w [color=blue]
  }
  client -> coredns_encrypted [label="DoT or DoH", color="blue"];

  coredns_encrypted -> pihole [color="red"];
  pihole -> coredns_DNS [color="red"];

  coredns_DNS -> google_dns [label="DNS-over-TLS", ltail=cluster_2, color="blue"];
  google_dns -> key:i1:w [style="invis"];
}
